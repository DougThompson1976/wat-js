<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
lang="en" xml:lang="en">
<head>
<title>Wat Language Manual</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2012-08-06 13:40:57 CEST"/>
<meta name="author" content="Manuel Simoni"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="stylesheet.css"/>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">

<h1 class="title">Wat Language Manual</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Description </a></li>
<li><a href="#sec-2">Lexical Structure </a></li>
<li><a href="#sec-3">Built-in Types </a></li>
<li><a href="#sec-4">Type Tags </a></li>
<li><a href="#sec-5">Pattern Matching </a></li>
<li><a href="#sec-6">Combiners </a></li>
<li><a href="#sec-7">Core </a>
<ul>
<li><a href="#sec-7.1">Basics </a>
<ul>
<li><a href="#sec-7.1.1"><code>def &lt;lhs&gt; &lt;rhs&gt; → rhs</code> [operative] </a></li>
<li><a href="#sec-7.1.2"><code>begin . &lt;exprs&gt; → result</code> [operative] </a></li>
<li><a href="#sec-7.1.3"><code>if &lt;test&gt; &lt;then&gt; &lt;else&gt; → result</code> [operative] </a></li>
<li><a href="#sec-7.1.4"><code>cons &lt;car&gt; &lt;cdr&gt; → cons</code> [applicative] </a></li>
<li><a href="#sec-7.1.5"><code>eq? &lt;a&gt; &lt;b&gt; → boolean</code> [applicative] </a></li>
</ul>
</li>
<li><a href="#sec-7.2">Vau Calculus </a>
<ul>
<li><a href="#sec-7.2.1"><code>vau &lt;ptree&gt; &lt;envp&gt; &lt;body&gt; → operative</code> [operative] </a></li>
<li><a href="#sec-7.2.2"><code>eval &lt;expr&gt; &lt;env&gt; → result</code> [applicative] </a></li>
<li><a href="#sec-7.2.3"><code>wrap &lt;cmb&gt; → applicative</code> [applicative] </a></li>
<li><a href="#sec-7.2.4"><code>unwrap &lt;cmb&gt; → combiner</code> [applicative] </a></li>
<li><a href="#sec-7.2.5"><code>make-environment [&lt;parent&gt;] → environment</code> [applicative] </a></li>
</ul>
</li>
<li><a href="#sec-7.3">Control </a>
<ul>
<li><a href="#sec-7.3.1"><code>make-prompt → prompt</code> [applicative] </a></li>
<li><a href="#sec-7.3.2"><code>push-prompt* &lt;prompt&gt; &lt;thunk&gt; → result</code> [applicative] </a></li>
<li><a href="#sec-7.3.3"><code>take-sub-cont* &lt;prompt&gt; &lt;cmb&gt; → result</code> [applicative] </a></li>
<li><a href="#sec-7.3.4"><code>push-sub-cont* &lt;cont&gt; &lt;thunk&gt; → result</code> [applicative] </a></li>
</ul>
</li>
<li><a href="#sec-7.4">Types </a>
<ul>
<li><a href="#sec-7.4.1"><code>make-type → type</code> [applicative] </a></li>
<li><a href="#sec-7.4.2"><code>type-environment &lt;type&gt; → environment</code> [applicative] </a></li>
<li><a href="#sec-7.4.3"><code>type-of &lt;val&gt; → type</code> [applicative] </a></li>
<li><a href="#sec-7.4.4"><code>tag &lt;type&gt; &lt;val&gt; → tagged</code> [applicative] </a></li>
<li><a href="#sec-7.4.5"><code>untag &lt;tagged&gt; → value</code> [applicative] </a></li>
</ul>
</li>
<li><a href="#sec-7.5">System </a>
<ul>
<li><a href="#sec-7.5.1"><code>display &lt;msg&gt; → msg</code> [applicative] </a></li>
<li><a href="#sec-7.5.2"><code>read-from-string &lt;string&gt; → forms</code> [applicative] </a></li>
<li><a href="#sec-7.5.3"><code>fail &lt;reason&gt; → |</code> [applicative] </a></li>
</ul>
</li>
<li><a href="#sec-7.6">Vectors </a>
<ul>
<li><a href="#sec-7.6.1"><code>vector . &lt;elements&gt; → vector</code> [applicative] </a></li>
<li><a href="#sec-7.6.2"><code>vector-ref &lt;vector&gt; &lt;index&gt; → element</code> [applicative] </a></li>
<li><a href="#sec-7.6.3"><code>vector-set! &lt;vector&gt; &lt;index&gt; &lt;element&gt; → element</code> [applicative] </a></li>
<li><a href="#sec-7.6.4"><code>vector-length &lt;vector&gt; → number</code> [applicative] </a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-8">Library </a>
<ul>
<li><a href="#sec-8.1">Common </a>
<ul>
<li><a href="#sec-8.1.1"><code>lambda &lt;ptree&gt; . &lt;exprs&gt; → applicative</code> [operative] </a></li>
<li><a href="#sec-8.1.2"><code>apply &lt;apv&gt; &lt;args&gt; → result</code> [applicative] </a></li>
<li><a href="#sec-8.1.3"><code>set! &lt;env&gt; &lt;lhs&gt; &lt;rhs&gt; → rhs</code> [operative] </a></li>
<li><a href="#sec-8.1.4"><code>quote &lt;form&gt; → form</code> [operative] </a></li>
<li><a href="#sec-8.1.5"><code>define &lt;lhs&gt; &lt;rhs&gt; → result</code> [operative] </a></li>
<li><a href="#sec-8.1.6"><code>define-syntax &lt;lhs&gt; &lt;rhs&gt; → result</code> [operative] </a></li>
<li><a href="#sec-8.1.7"><code>provide &lt;names&gt; . &lt;exprs&gt; → result</code> [operative] </a></li>
</ul>
</li>
<li><a href="#sec-8.2">Pairs and Lists </a>
<ul>
<li><a href="#sec-8.2.1"><code>car &lt;pair&gt; → value</code> [applicative] </a></li>
<li><a href="#sec-8.2.2"><code>cdr &lt;pair&gt; → value</code> [applicative] </a></li>
<li><a href="#sec-8.2.3"><code>caar</code>, <code>cadr</code>, <code>cdar</code>, <code>cddr</code> [applicatives] </a></li>
<li><a href="#sec-8.2.4"><code>null? &lt;val&gt; → boolean</code> [applicative] </a></li>
<li><a href="#sec-8.2.5"><code>pair? &lt;val&gt; → boolean</code> [applicative] </a></li>
<li><a href="#sec-8.2.6"><code>list . &lt;vals&gt; → list</code> [applicative] </a></li>
<li><a href="#sec-8.2.7"><code>list* . &lt;vals&gt; → list</code> [applicative] </a></li>
</ul>
</li>
<li><a href="#sec-8.3">Dynamic Binding </a>
<ul>
<li><a href="#sec-8.3.1"><code>dnew → dynamic</code> [applicative] </a></li>
<li><a href="#sec-8.3.2"><code>dlet &lt;dynamic&gt; &lt;value&gt; . &lt;exprs&gt; → result</code> [operative] </a></li>
<li><a href="#sec-8.3.3"><code>dref &lt;dynamic&gt; → value</code> [applicative] </a></li>
</ul>
</li>
<li><a href="#sec-8.4">Generic Programming </a>
<ul>
<li><a href="#sec-8.4.1"><code>define-generic (&lt;name&gt; . &lt;args&gt;) → generic</code> [operative] </a></li>
<li><a href="#sec-8.4.2"><code>define-method (&lt;name&gt; (&lt;self&gt; &lt;type&gt;) . &lt;args&gt;) → method</code> [operative] </a></li>
<li><a href="#sec-8.4.3"><code>send &lt;obj&gt; &lt;msg&gt; &lt;arg&gt; → result</code> [applicative] </a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-9">External </a>
<ul>
<li><a href="#sec-9.1">JavaScript Bridge </a>
<ul>
<li><a href="#sec-9.1.1"><code>js-global &lt;string&gt; → result</code> [applicative] </a></li>
<li><a href="#sec-9.1.2"><code>js-set-global! &lt;string&gt; &lt;val&gt; → val</code> [applicative] </a></li>
<li><a href="#sec-9.1.3"><code>js-prop &lt;object&gt; &lt;string&gt; → result</code> [applicative] </a></li>
<li><a href="#sec-9.1.4"><code>js-set-prop! &lt;object&gt; &lt;string&gt; &lt;val&gt; → val</code> [applicative] </a></li>
<li><a href="#sec-9.1.5"><code>js-function &lt;jsfun&gt; → applicative</code> [applicative] </a></li>
<li><a href="#sec-9.1.6"><code>js-method &lt;string&gt; → cmb</code> [applicative] </a></li>
<li><a href="#sec-9.1.7"><code>js-callback &lt;cmb&gt; → jsfun</code> [applicative] </a></li>
<li><a href="#sec-9.1.8"><code>to-js &lt;obj&gt; → jsobj</code> [applicative] </a></li>
<li><a href="#sec-9.1.9"><code>from-js &lt;js-obj&gt; → obj</code> [applicative] </a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Description </h2>
<div class="outline-text-2" id="text-1">


<p>
<i>Wat</i> is an ultra-lightweight dialect of Lisp, specifically
<a href="http://web.cs.wpi.edu/~jshutt/kernel.html">Kernel</a>, in which
everything is first-class: syntax, control, and data.  Syntax is based
on lexically-scoped fexprs and first-class environments, subsuming
ordinary procedures and hygienic macros.  Control is based on
delimited continuations and tail-call elimination, subsuming all
computational effects.  Data uses a dynamic type-tagging system that
allows generic programming over built-in as well as user-defined data
types.
</p>
<p>
Wat is hosted at <a href="https://github.com/manuel/wat-js">https://github.com/manuel/wat-js</a>.
</p>
<p>
This manual assumes familiarity with Kernel and Scheme.
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">Lexical Structure </h2>
<div class="outline-text-2" id="text-2">


<p>
Wat has a mostly Scheme-like lexical structure, incompletely described
by the following table:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<tbody>
<tr><td>; &hellip;</td><td><i>line comment</i></td></tr>
<tr><td>. + - [0-9]+</td><td><i>number</i></td></tr>
<tr><td>#t #f</td><td><i>logical constants</i></td></tr>
<tr><td>#void #ign</td><td><i>void and ignore constants</i></td></tr>
<tr><td>" &hellip; "</td><td><i>string</i></td></tr>
<tr><td>\\ \" \n \r \t</td><td><i>escape character in string</i></td></tr>
<tr><td>( &hellip; )</td><td><i>list</i></td></tr>
<tr><td>( a b . c )</td><td><i>dotted list</i></td></tr>
<tr><td>()</td><td><i>nil</i></td></tr>
<tr><td>a-z A-Z 0-9 - &amp; ! : = &gt; &lt; % + ? / * # $ _ ' .</td><td><i>symbol characters</i></td></tr>
<tr><td>'&lt;expr&gt;</td><td><i>short for</i> <code>(quote &lt;expr&gt;)</code></td></tr>
</tbody>
</table>


<p>
Wat identifiers are case-sensitive.
</p>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">Built-in Types </h2>
<div class="outline-text-2" id="text-3">


<dl>
<dt>Void</dt><dd>
The constant <code>#void</code> is used when there is no interesting
value to return, or when a value is unspecified.

</dd>
<dt>Ignore</dt><dd>
The constant <code>#ign</code> is used in parameter lists to indicate
that an argument is ignored and should not be bound in the
combiner's environment.

</dd>
<dt>Boolean</dt><dd>
The <code>#t</code> constant represents logical truth and the <code>#f</code>
constant represents logical falsity.

</dd>
<dt>Number</dt><dd>
Wat currently only supports IEEE 754 floating-point
numbers.

</dd>
<dt>String</dt><dd>
Wat currently only supports UTF-16 encoded Unicode
strings.

</dd>
<dt>Symbol</dt><dd>
Symbols are used as identifiers for variable bindings.
It is not guaranteed that symbols with the same name are pointer
identical.

</dd>
<dt>List</dt><dd>
Lists are built from immutable conses and nil.  Notably,
lists often contain not only symbols and literals (as is usual in
Lisp) but also first-class objects such as combiners.

</dd>
<dt>Environment</dt><dd>
An environment maps symbols to values.  It may have
a parent environment in which symbols are looked up if they are not
found in this environment.

</dd>
<dt>Operative (combiner)</dt><dd>
A combiner that operates directly on its operands.

</dd>
<dt>Applicative (combiner)</dt><dd>
A combiner that evaluates its operands, yielding an
arguments list, which it passes to an underlying combiner.

</dd>
<dt>Type (tag)</dt><dd>
A first-class type tag or just type is associated
with every object, discussed in the next section.

</dd>
<dt>Vector</dt><dd>
An array of objects.

</dd>
</dl>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4">Type Tags </h2>
<div class="outline-text-2" id="text-4">


<p>
Every object in Wat has a type tag or just type.  A type is a
first-class object that contains an (initially empty) environment into
which programmers may store metadata.  Type tags are provided for all
built-in types, and there are routines for creating new types and
tagged objects that wrap an underlying value with a type.  Type tags
allow the definition of type systems in userland that interoperate
with the built-in types.
</p>
<p>
By principle, Wat does not support fully encapsulated data, i.e. data
that cannot be inspected from the outside.  Total visibility into the
running program for debugging and introspection is valued over the
ability to create total abstraction.  A better design based on
mirror-based reflection is probably possible.
</p>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5">Pattern Matching </h2>
<div class="outline-text-2" id="text-5">


<p>
As in Kernel, parameters and left-hand sides of definitions may not
only be symbols, but parameter trees: a parameter tree is either a
symbol, a cons, nil, or ignore.  A symbol binds the right hand to its
name, a cons recursively matches its car and cdr, nil matches only
nil, and ignore simply ignores the right-hand side.
</p>
<p>
Examples:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">Left-hand side</th><th scope="col">Right-hand side</th><th scope="col">Match results</th></tr>
</thead>
<tbody>
<tr><td>a</td><td>(1 (2) 3)</td><td>a → (1 (2) 3)</td></tr>
<tr><td>(a . b)</td><td>(1 (2) 3)</td><td>a → 1, b → ((2) 3)</td></tr>
<tr><td>(a b c)</td><td>(1 (2) 3)</td><td>a → 1, b → (2), c → 3</td></tr>
<tr><td>(a (b) . #ign)</td><td>(1 (2) 3)</td><td>a → 1, b → 2</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6">Combiners </h2>
<div class="outline-text-2" id="text-6">


<p>
All computations in Wat are carried out by combiners, of which there
are two different kinds: operative and applicative.  An operative
combiner or just operative is a fexpr that receives the current
lexical environment and acts on its operand tree unevaluated.  An
applicative combiner or just applicative is a procedure that first
evaluates its operand tree and then passes the obtained arguments list
to an underlying combiner.  <code>vau</code> is the constructor of user-defined
operatives, called compound operatives.  <code>wrap</code> creates an applicative
around an underlying combiner.
</p>
<p>
Examples:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">Combiner</th><th scope="col">Operand Tree</th><th scope="col">Result</th></tr>
</thead>
<tbody>
<tr><td><code>(vau x #ign x)</code></td><td>(1 (+ 2 3) 4)</td><td>(1 (+ 2 3) 4)</td></tr>
<tr><td><code>(vau #ign e e)</code></td><td>(1 (+ 2 3) 4)</td><td><i>&lt;the current environment&gt;</i></td></tr>
<tr><td><code>(wrap (vau x #ign x))</code></td><td>(1 (+ 2 3) 4)</td><td>(1 5 4)</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7">Core </h2>
<div class="outline-text-2" id="text-7">


<p>
The core contains primitive functionality that could not be
implemented in Wat itself (or it would be cumbersome to do so).
</p>

</div>

<div id="outline-container-7.1" class="outline-3">
<h3 id="sec-7.1">Basics </h3>
<div class="outline-text-3" id="text-7.1">


</div>

<div id="outline-container-7.1.1" class="outline-4">
<h4 id="sec-7.1.1"><code>def &lt;lhs&gt; &lt;rhs&gt; → rhs</code> [operative] </h4>
<div class="outline-text-4" id="text-7.1.1">


<p>
Evaluates the right-hand side, matches the left-hand side against it
in the current environment, and returns it.
</p>
</div>

</div>

<div id="outline-container-7.1.2" class="outline-4">
<h4 id="sec-7.1.2"><code>begin . &lt;exprs&gt; → result</code> [operative] </h4>
<div class="outline-text-4" id="text-7.1.2">


<p>
Evaluates expressions from left to right, returning the value of the
last.  As a special case, <code>(begin)</code> returns void.
</p>
<p>
Note: <code>begin</code> could be implemented in the library, but for performance
reasons is built into the core.
</p>
</div>

</div>

<div id="outline-container-7.1.3" class="outline-4">
<h4 id="sec-7.1.3"><code>if &lt;test&gt; &lt;then&gt; &lt;else&gt; → result</code> [operative] </h4>
<div class="outline-text-4" id="text-7.1.3">


<p>
Evaluates the test, and if it is false evaluates the else branch,
otherwise evaluates the then branch.  The branches are evaluated in
tail position.
</p>
</div>

</div>

<div id="outline-container-7.1.4" class="outline-4">
<h4 id="sec-7.1.4"><code>cons &lt;car&gt; &lt;cdr&gt; → cons</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.1.4">


<p>
Creates a new cons with the given car and cdr.
</p>
</div>

</div>

<div id="outline-container-7.1.5" class="outline-4">
<h4 id="sec-7.1.5"><code>eq? &lt;a&gt; &lt;b&gt; → boolean</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.1.5">


<p>
Returns true if the two values are pointer identical, false otherwise.
</p>
</div>
</div>

</div>

<div id="outline-container-7.2" class="outline-3">
<h3 id="sec-7.2">Vau Calculus </h3>
<div class="outline-text-3" id="text-7.2">


</div>

<div id="outline-container-7.2.1" class="outline-4">
<h4 id="sec-7.2.1"><code>vau &lt;ptree&gt; &lt;envp&gt; &lt;body&gt; → operative</code> [operative] </h4>
<div class="outline-text-4" id="text-7.2.1">


<p>
Constructs a new compound operative that closes over the current
environment with the given parameter tree, environment parameter, and
body expression.
</p>
</div>

</div>

<div id="outline-container-7.2.2" class="outline-4">
<h4 id="sec-7.2.2"><code>eval &lt;expr&gt; &lt;env&gt; → result</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.2.2">


<p>
Evaluates the expression in the given environment.  The expression is
evaluated in tail-position.
</p>
</div>

</div>

<div id="outline-container-7.2.3" class="outline-4">
<h4 id="sec-7.2.3"><code>wrap &lt;cmb&gt; → applicative</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.2.3">


<p>
Returns an applicative around an underlying combiner.
</p>
</div>

</div>

<div id="outline-container-7.2.4" class="outline-4">
<h4 id="sec-7.2.4"><code>unwrap &lt;cmb&gt; → combiner</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.2.4">


<p>
Returns the underlying combiner of an applicative.
</p>
</div>

</div>

<div id="outline-container-7.2.5" class="outline-4">
<h4 id="sec-7.2.5"><code>make-environment [&lt;parent&gt;] → environment</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.2.5">


<p>
Creates a new empty environment with the given optional parent.
</p>
</div>
</div>

</div>

<div id="outline-container-7.3" class="outline-3">
<h3 id="sec-7.3">Control </h3>
<div class="outline-text-3" id="text-7.3">


<p>
These are the control operators from Dybvig, Jones, and Sabry's <a href="http://www.cs.indiana.edu/~dyb/pubs/monadicDC.pdf"><i>A Monadic Framework for Delimited Continuations</i></a> that are able to
express all other delimited control operators.
</p>

</div>

<div id="outline-container-7.3.1" class="outline-4">
<h4 id="sec-7.3.1"><code>make-prompt → prompt</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.3.1">


<p>
Creates a fresh prompt.
</p>
</div>

</div>

<div id="outline-container-7.3.2" class="outline-4">
<h4 id="sec-7.3.2"><code>push-prompt* &lt;prompt&gt; &lt;thunk&gt; → result</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.3.2">


<p>
Pushes the continuation-delimiting prompt and executes thunk in the
new continuation.
</p>
</div>

</div>

<div id="outline-container-7.3.3" class="outline-4">
<h4 id="sec-7.3.3"><code>take-sub-cont* &lt;prompt&gt; &lt;cmb&gt; → result</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.3.3">


<p>
Aborts up to and including the prompt, and calls the combiner with a
single argument representing the delimited continuation from the call
to <code>take-sub-cont*</code> up to but not including the prompt.
</p>
</div>

</div>

<div id="outline-container-7.3.4" class="outline-4">
<h4 id="sec-7.3.4"><code>push-sub-cont* &lt;cont&gt; &lt;thunk&gt; → result</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.3.4">


<p>
Prepends the delimited continuation to the current continuation, and
executes thunk in the new continuation.
</p>
</div>
</div>

</div>

<div id="outline-container-7.4" class="outline-3">
<h3 id="sec-7.4">Types </h3>
<div class="outline-text-3" id="text-7.4">


</div>

<div id="outline-container-7.4.1" class="outline-4">
<h4 id="sec-7.4.1"><code>make-type → type</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.4.1">


<p>
Creates a new type with an empty environment.
</p>
</div>

</div>

<div id="outline-container-7.4.2" class="outline-4">
<h4 id="sec-7.4.2"><code>type-environment &lt;type&gt; → environment</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.4.2">


<p>
Returns the type's environment for storing metadata.
</p>
</div>

</div>

<div id="outline-container-7.4.3" class="outline-4">
<h4 id="sec-7.4.3"><code>type-of &lt;val&gt; → type</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.4.3">


<p>
Returns an object's type.
</p>
</div>

</div>

<div id="outline-container-7.4.4" class="outline-4">
<h4 id="sec-7.4.4"><code>tag &lt;type&gt; &lt;val&gt; → tagged</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.4.4">


<p>
Creates a new user-tagged object with a type and wrapping an
underlying value.
</p>
</div>

</div>

<div id="outline-container-7.4.5" class="outline-4">
<h4 id="sec-7.4.5"><code>untag &lt;tagged&gt; → value</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.4.5">


<p>
Returns the underlying value of a user-tagged object.
</p>
</div>
</div>

</div>

<div id="outline-container-7.5" class="outline-3">
<h3 id="sec-7.5">System </h3>
<div class="outline-text-3" id="text-7.5">


</div>

<div id="outline-container-7.5.1" class="outline-4">
<h4 id="sec-7.5.1"><code>display &lt;msg&gt; → msg</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.5.1">


<p>
Prints a message string to the console and returns it.
</p>
</div>

</div>

<div id="outline-container-7.5.2" class="outline-4">
<h4 id="sec-7.5.2"><code>read-from-string &lt;string&gt; → forms</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.5.2">


<p>
Parses a string into a list of forms.
</p>
</div>

</div>

<div id="outline-container-7.5.3" class="outline-4">
<h4 id="sec-7.5.3"><code>fail &lt;reason&gt; → |</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.5.3">


<p>
Halts evaluation with an object describing the reason (typically an error).
</p>
</div>
</div>

</div>

<div id="outline-container-7.6" class="outline-3">
<h3 id="sec-7.6">Vectors </h3>
<div class="outline-text-3" id="text-7.6">



</div>

<div id="outline-container-7.6.1" class="outline-4">
<h4 id="sec-7.6.1"><code>vector . &lt;elements&gt; → vector</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.6.1">


<p>
Creates a new vector with the given elements.
</p>
</div>

</div>

<div id="outline-container-7.6.2" class="outline-4">
<h4 id="sec-7.6.2"><code>vector-ref &lt;vector&gt; &lt;index&gt; → element</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.6.2">


<p>
Returns the vector's element at the given index.
</p>
</div>

</div>

<div id="outline-container-7.6.3" class="outline-4">
<h4 id="sec-7.6.3"><code>vector-set! &lt;vector&gt; &lt;index&gt; &lt;element&gt; → element</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.6.3">


<p>
Updates the vector's element at the given index and returns it.
</p>
</div>

</div>

<div id="outline-container-7.6.4" class="outline-4">
<h4 id="sec-7.6.4"><code>vector-length &lt;vector&gt; → number</code> [applicative] </h4>
<div class="outline-text-4" id="text-7.6.4">


<p>
Returns the number of elements in the vector.
</p>
</div>
</div>
</div>

</div>

<div id="outline-container-8" class="outline-2">
<h2 id="sec-8">Library </h2>
<div class="outline-text-2" id="text-8">


<p>
The library consists of definitions written in Wat itself.
</p>

</div>

<div id="outline-container-8.1" class="outline-3">
<h3 id="sec-8.1">Common </h3>
<div class="outline-text-3" id="text-8.1">


</div>

<div id="outline-container-8.1.1" class="outline-4">
<h4 id="sec-8.1.1"><code>lambda &lt;ptree&gt; . &lt;exprs&gt; → applicative</code> [operative] </h4>
<div class="outline-text-4" id="text-8.1.1">


<p>
Creates an applicative combiner, as in Scheme.
</p>
</div>

</div>

<div id="outline-container-8.1.2" class="outline-4">
<h4 id="sec-8.1.2"><code>apply &lt;apv&gt; &lt;args&gt; → result</code> [applicative] </h4>
<div class="outline-text-4" id="text-8.1.2">


<p>
Applies an applicative to an arguments list.
</p>
</div>

</div>

<div id="outline-container-8.1.3" class="outline-4">
<h4 id="sec-8.1.3"><code>set! &lt;env&gt; &lt;lhs&gt; &lt;rhs&gt; → rhs</code> [operative] </h4>
<div class="outline-text-4" id="text-8.1.3">


<p>
Updates the left-hand side bindings by matching it against the
right-hand side in the given environment.
</p>
</div>

</div>

<div id="outline-container-8.1.4" class="outline-4">
<h4 id="sec-8.1.4"><code>quote &lt;form&gt; → form</code> [operative] </h4>
<div class="outline-text-4" id="text-8.1.4">


<p>
Returns form unevaluated.
</p>
</div>

</div>

<div id="outline-container-8.1.5" class="outline-4">
<h4 id="sec-8.1.5"><code>define &lt;lhs&gt; &lt;rhs&gt; → result</code> [operative] </h4>
<div class="outline-text-4" id="text-8.1.5">


<p>
Scheme-like <code>define</code> with two cases:
</p>
<ul>
<li>
<code>(define &lt;name&gt; &lt;value&gt;)</code> simply binds name to value, returning value.

</li>
<li>
<code>(define (&lt;name&gt; . &lt;params&gt;) . &lt;body&gt;)</code> binds name to an
applicative with the given parameters and body expressions,
returning the applicative.

</li>
</ul>
</div>

</div>

<div id="outline-container-8.1.6" class="outline-4">
<h4 id="sec-8.1.6"><code>define-syntax &lt;lhs&gt; &lt;rhs&gt; → result</code> [operative] </h4>
<div class="outline-text-4" id="text-8.1.6">


<p>
Scheme-like <code>define-syntax</code> with two cases:
</p>
<ul>
<li>
<code>(define-syntax &lt;name&gt; &lt;value&gt;)</code> simply binds name to value,
returning value.

</li>
<li>
<code>(define-syntax (&lt;name&gt; . &lt;params&gt;) &lt;envparam&gt; . &lt;body&gt;)</code> binds
name to an operative with the given parameters, environment
parameter, and body expressions, returning the operative.

</li>
</ul>
</div>

</div>

<div id="outline-container-8.1.7" class="outline-4">
<h4 id="sec-8.1.7"><code>provide &lt;names&gt; . &lt;exprs&gt; → result</code> [operative] </h4>
<div class="outline-text-4" id="text-8.1.7">


<p>
Performs expressions in a new lexical scope and exports only listed
names to the outer scope.
</p>



<pre class="example">(provide (foo bar)
  (def foo 1)
  (def bar 2)
  (def quux 3)
)
foo → 1
bar → 2
quux → error: unbound variable
</pre>




</div>
</div>

</div>

<div id="outline-container-8.2" class="outline-3">
<h3 id="sec-8.2">Pairs and Lists </h3>
<div class="outline-text-3" id="text-8.2">



</div>

<div id="outline-container-8.2.1" class="outline-4">
<h4 id="sec-8.2.1"><code>car &lt;pair&gt; → value</code> [applicative] </h4>
<div class="outline-text-4" id="text-8.2.1">



<p>
Contents of the Address part of Register.
</p>
</div>

</div>

<div id="outline-container-8.2.2" class="outline-4">
<h4 id="sec-8.2.2"><code>cdr &lt;pair&gt; → value</code> [applicative] </h4>
<div class="outline-text-4" id="text-8.2.2">


<p>
Contents of the Decrement part of Register.
</p>
</div>

</div>

<div id="outline-container-8.2.3" class="outline-4">
<h4 id="sec-8.2.3"><code>caar</code>, <code>cadr</code>, <code>cdar</code>, <code>cddr</code> [applicatives] </h4>
<div class="outline-text-4" id="text-8.2.3">


<p>
Combinations of <code>car</code> and <code>cdr</code>, e.g. <code>(cadr x)</code> === <code>(car (cdr x))</code>.
</p>
</div>

</div>

<div id="outline-container-8.2.4" class="outline-4">
<h4 id="sec-8.2.4"><code>null? &lt;val&gt; → boolean</code> [applicative] </h4>
<div class="outline-text-4" id="text-8.2.4">


<p>
Returns true if a value is nil, the empty list, false otherwise.
</p>
</div>

</div>

<div id="outline-container-8.2.5" class="outline-4">
<h4 id="sec-8.2.5"><code>pair? &lt;val&gt; → boolean</code> [applicative] </h4>
<div class="outline-text-4" id="text-8.2.5">


<p>
Returns true if a value is a pair (cons), false otherwise.
</p>
</div>

</div>

<div id="outline-container-8.2.6" class="outline-4">
<h4 id="sec-8.2.6"><code>list . &lt;vals&gt; → list</code> [applicative] </h4>
<div class="outline-text-4" id="text-8.2.6">


<p>
Constructs a nil-terminated list containing the values.
</p>
</div>

</div>

<div id="outline-container-8.2.7" class="outline-4">
<h4 id="sec-8.2.7"><code>list* . &lt;vals&gt; → list</code> [applicative] </h4>
<div class="outline-text-4" id="text-8.2.7">


<p>
Constructs a list of the values, terminated by the last value.
</p>
</div>
</div>

</div>

<div id="outline-container-8.3" class="outline-3">
<h3 id="sec-8.3">Dynamic Binding </h3>
<div class="outline-text-3" id="text-8.3">


<p>
These are the operators from Kiselyov, Shan, and Sabry's
<a href="http://okmij.org/ftp/papers/DDBinding.pdf"><i>Delimited Dynamic Binding</i></a>.
</p>

</div>

<div id="outline-container-8.3.1" class="outline-4">
<h4 id="sec-8.3.1"><code>dnew → dynamic</code> [applicative] </h4>
<div class="outline-text-4" id="text-8.3.1">


<p>
Creates a new dynamically-bound variable.
</p>
</div>

</div>

<div id="outline-container-8.3.2" class="outline-4">
<h4 id="sec-8.3.2"><code>dlet &lt;dynamic&gt; &lt;value&gt; . &lt;exprs&gt; → result</code> [operative] </h4>
<div class="outline-text-4" id="text-8.3.2">


<p>
Performs expressions with the dynamic variable bound to the value.
</p>
</div>

</div>

<div id="outline-container-8.3.3" class="outline-4">
<h4 id="sec-8.3.3"><code>dref &lt;dynamic&gt; → value</code> [applicative] </h4>
<div class="outline-text-4" id="text-8.3.3">


<p>
Retrieves the dynamically-bound value of a dynamic variable.
</p>
</div>
</div>

</div>

<div id="outline-container-8.4" class="outline-3">
<h3 id="sec-8.4">Generic Programming </h3>
<div class="outline-text-3" id="text-8.4">



</div>

<div id="outline-container-8.4.1" class="outline-4">
<h4 id="sec-8.4.1"><code>define-generic (&lt;name&gt; . &lt;args&gt;) → generic</code> [operative] </h4>
<div class="outline-text-4" id="text-8.4.1">


<p>
Defines a new generic function with the given name.
</p>
</div>

</div>

<div id="outline-container-8.4.2" class="outline-4">
<h4 id="sec-8.4.2"><code>define-method (&lt;name&gt; (&lt;self&gt; &lt;type&gt;) . &lt;args&gt;) → method</code> [operative] </h4>
<div class="outline-text-4" id="text-8.4.2">


<p>
Defines a new method for a generic function.
</p>
</div>

</div>

<div id="outline-container-8.4.3" class="outline-4">
<h4 id="sec-8.4.3"><code>send &lt;obj&gt; &lt;msg&gt; &lt;arg&gt; → result</code> [applicative] </h4>
<div class="outline-text-4" id="text-8.4.3">


<p>
Sends object a message with an argument.
</p>
</div>
</div>
</div>

</div>

<div id="outline-container-9" class="outline-2">
<h2 id="sec-9">External </h2>
<div class="outline-text-2" id="text-9">


</div>

<div id="outline-container-9.1" class="outline-3">
<h3 id="sec-9.1">JavaScript Bridge </h3>
<div class="outline-text-3" id="text-9.1">



</div>

<div id="outline-container-9.1.1" class="outline-4">
<h4 id="sec-9.1.1"><code>js-global &lt;string&gt; → result</code> [applicative] </h4>
<div class="outline-text-4" id="text-9.1.1">


<p>
Returns value of JavaScript global variable with given name.
</p>
</div>

</div>

<div id="outline-container-9.1.2" class="outline-4">
<h4 id="sec-9.1.2"><code>js-set-global! &lt;string&gt; &lt;val&gt; → val</code> [applicative] </h4>
<div class="outline-text-4" id="text-9.1.2">


<p>
Updates value of JavaScript global variable with given name and returns it.
</p>
</div>

</div>

<div id="outline-container-9.1.3" class="outline-4">
<h4 id="sec-9.1.3"><code>js-prop &lt;object&gt; &lt;string&gt; → result</code> [applicative] </h4>
<div class="outline-text-4" id="text-9.1.3">


<p>
Returns value of JavaScript member variable with given name of object.
</p>
</div>

</div>

<div id="outline-container-9.1.4" class="outline-4">
<h4 id="sec-9.1.4"><code>js-set-prop! &lt;object&gt; &lt;string&gt; &lt;val&gt; → val</code> [applicative] </h4>
<div class="outline-text-4" id="text-9.1.4">


<p>
Updates value of JavaScript member variable with given name of object
and returns it.
</p>
</div>

</div>

<div id="outline-container-9.1.5" class="outline-4">
<h4 id="sec-9.1.5"><code>js-function &lt;jsfun&gt; → applicative</code> [applicative] </h4>
<div class="outline-text-4" id="text-9.1.5">


<p>
Creates an applicative that when called will call the given JavaScript
function with the arguments it received.
</p>
</div>

</div>

<div id="outline-container-9.1.6" class="outline-4">
<h4 id="sec-9.1.6"><code>js-method &lt;string&gt; → cmb</code> [applicative] </h4>
<div class="outline-text-4" id="text-9.1.6">


<p>
Creates an applicative that when called on an object and zero or more
arguments will invoke the method with the given string name of the
object with the given arguments.
</p>
</div>

</div>

<div id="outline-container-9.1.7" class="outline-4">
<h4 id="sec-9.1.7"><code>js-callback &lt;cmb&gt; → jsfun</code> [applicative] </h4>
<div class="outline-text-4" id="text-9.1.7">


<p>
Creates a JavaScript function that when called will call the given
combiner with the arguments it received.
</p>
</div>

</div>

<div id="outline-container-9.1.8" class="outline-4">
<h4 id="sec-9.1.8"><code>to-js &lt;obj&gt; → jsobj</code> [applicative] </h4>
<div class="outline-text-4" id="text-9.1.8">


<p>
Try to convert an object, such as a string, to a usable JavaScript object.
</p>
</div>

</div>

<div id="outline-container-9.1.9" class="outline-4">
<h4 id="sec-9.1.9"><code>from-js &lt;js-obj&gt; → obj</code> [applicative] </h4>
<div class="outline-text-4" id="text-9.1.9">


<p>
Try to convert a JavaScript object, such as a string, to a usable Wat object.
</p></div>
</div>
</div>
</div>
<div id="postamble">
<p class="author"> Author: Manuel Simoni
<a href="mailto:msimoni@gmail.com">&lt;msimoni@gmail.com&gt;</a>
</p>
<p class="date"> Date: 2012-08-06 13:40:57 CEST</p>
</div>
</div>
</body>
</html>

<!-- WAT browser REPL. -->
<html>
<head>
  <title>Wat</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/> 
  <script type="text/javascript" src="../wat.js"></script>
</head>
<body>
<h1><a href="https://github.com/manuel/wat-js">Wat</a></h1>
<script type="text/javascript">

function wat_self_test() {
    var vm = new Wat();
    function assert(label, that) { if (!that) throw "assertion failed: " + label; }
    function assertFails(label, fun) { try { fun(); } catch(exc) { return; } throw "should have failed:" + label; }
    assert("vau", vm.run([["wat-vau", ["x"], "#ignore", "x"], 1]) === 1);
    assertFails("vau-unbound-var", function() { vm.run([["wat-vau", ["#ignore"], "#ignore", "x"], 1]); });
    assertFails("vau-wrong-var", function() { vm.run([["wat-vau", ["y"], "#ignore", "x"], 1]); });
    assertFails("nil-app", function() { vm.run([[]]); });
    assertFails("unbound-app", function() { vm.run([["x"]]); });
}
wat_self_test();

var self_test = 
    ["begin",
     ["define", "bar", ["lambda", [], ["+", 3, 4]]],
     ["define-macro", ["foo"], ["list", "bar"]],
     [alert, ["foo"]],
     ["!", 12],
     [".", document, "write", 11],
     ["[]=", window, 12, 1],
     ["[]", window, 12],
    ];
console.log(new Wat().run(self_test));
</script>
</body>
</html>
